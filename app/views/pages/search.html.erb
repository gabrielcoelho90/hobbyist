<h1>Search for people with the same interest</h1>

<div class="container"
    data-controller="map"
    data-map-markers-value="<%= @markers.to_json %>"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>" >

    <%= simple_form_for @blank_interest, html: { class: 'border my-3' } do |f| %>
      <%# <h2>Your interests</h2> %>
      <%= f.collection_check_boxes :interestable_id, current_user.subcommunities, :id, :name do |b|  %>
        <%= b.check_box(class: 'btn-check', autocomplete: 'off') %>
        <%= b.label(class: 'btn m-1 rounded-pill') %>
      <% end %>

      <%# <h2>All Interests</h2> %>
          <div class="accordion my-3" id="filtersAccordion">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="false" aria-controls="filtersCollapse">
                  Filter All Communities
                </button>
              </h2>
              <div id="filtersCollapse" class="accordion-collapse collapse" data-bs-parent="#filtersAccordion">
                <div class="accordion-body">
                  <div>

                    <% @communities.each do |community| %>
                      <% accordion_id = "accordion#{community.name}" %>
                      <% collapse_id = "collapse#{community.name}" %>
                      <% subcommunity_arr = Subcommunity.all.where(community: community)%>
                      <% filter_arr = subcommunity_arr.reject { |sub| current_user.subcommunities.include?(sub) } %>
                      <div class="accordion my-3" id="<%= accordion_id %>">
                        <div class="accordion-item">
                          <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#<%= collapse_id %>" aria-expanded="false" aria-controls="<%= collapse_id %>">
                              <%= community.name %>
                            </button>
                          </h2>
                          <div id="<%= collapse_id %>" class="accordion-collapse collapse" data-bs-parent="#<%= accordion_id %>">
                            <div class="accordion-body">
                              <div>
                                <%= f.collection_check_boxes :interestable_id, filter_arr, :id, :name do |b|  %>
                                  <%= b.check_box(class: 'btn-check', autocomplete: 'off') %>
                                  <%= b.label(class: 'btn m-1 rounded-pill') %>
                                <% end %>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    <% end %>

                  </div>
                </div>
              </div>
            </div>
          </div>



        <%= f.button :submit, class: 'btn btn-primary m-2' %>
    <% end %>

  <div class = "main-search-bar" data-map-target = "mainSearch"></div>
  <div class="row">
    <div class="col-3">
      <% @users.each do |user| %>
      <p><%= user.username %></p>
      <% end %>
    </div>
    <div class="col-9">
    <div style="width: 100%; height: 600px;" data-map-target = "mapContainer"></div>
    </div>
  </div>
</div>





<div>
  <ul>
    <li> <%= link_to "painting", search_page_path(query: "painting")%> painting</li>
    <li>Arts</li>
    <li>Games</li>
    <li>Music</li>
  </ul>
</div>

<#% @communities.each do |community| %>
<#%= community.interests %>
<#% end %>
